<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 대시보드 - 통합 모니터링</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-info {
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 14px;
        }

        .refresh-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .refresh-indicator.loading {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Container */
        .container {
            max-width: 1600px;
            margin: 30px auto;
            padding: 0 20px;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.12);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .metric-title {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .metric-icon {
            width: 45px;
            height: 45px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .metric-icon.blue { background: #e3f2fd; color: #2196f3; }
        .metric-icon.green { background: #e8f5e9; color: #4caf50; }
        .metric-icon.orange { background: #fff3e0; color: #ff9800; }
        .metric-icon.red { background: #ffebee; color: #f44336; }
        .metric-icon.purple { background: #f3e5f5; color: #9c27b0; }

        .metric-value {
            font-size: 36px;
            font-weight: 700;
            margin: 10px 0;
        }

        .metric-change {
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .metric-change.positive { color: #4caf50; }
        .metric-change.negative { color: #f44336; }
        .metric-change.neutral { color: #757575; }

        /* Charts Section */
        .charts-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .chart-card h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .chart-tab {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .chart-tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .chart-tab:hover:not(.active) {
            background: #f5f5f5;
        }

        /* Activity Feed */
        .activity-section {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .activity-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .activity-card h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .activity-item {
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .activity-item-title {
            font-weight: 500;
            color: #333;
            cursor: pointer;
            transition: color 0.2s;
        }

        .activity-item-title:hover {
            color: #667eea;
        }

        .activity-item-time {
            font-size: 12px;
            color: #999;
        }

        .activity-item-author {
            font-size: 13px;
            color: #666;
        }

        /* Popular Boards */
        .popular-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .popular-section h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .popular-table {
            width: 100%;
            border-collapse: collapse;
        }

        .popular-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-size: 13px;
            color: #666;
            font-weight: 600;
            border-bottom: 2px solid #e0e0e0;
        }

        .popular-table td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }

        .popular-table tr:hover {
            background: #f8f9fa;
        }

        .popular-table .title-cell {
            font-weight: 500;
            color: #333;
            cursor: pointer;
            transition: color 0.2s;
        }

        .popular-table .title-cell:hover {
            color: #667eea;
        }

        .popular-table .score-cell {
            font-weight: 600;
            color: #667eea;
        }

        /* Priority Badge */
        .priority-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-badge.critical {
            background: #ffebee;
            color: #c62828;
        }

        .priority-badge.high {
            background: #fff3e0;
            color: #e65100;
        }

        .priority-badge.medium {
            background: #fff9c4;
            color: #f57f17;
        }

        .priority-badge.low {
            background: #e8f5e9;
            color: #2e7d32;
        }

        /* Loading Spinner */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .quick-action-btn {
            padding: 12px 20px;
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quick-action-btn:hover {
            background: #667eea;
            color: white;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .charts-section {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            .activity-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>
            <i class="fas fa-chart-line"></i>
            관리자 대시보드
        </h1>
        <div class="header-info">
            <div class="refresh-indicator" id="refreshIndicator">
                <i class="fas fa-sync-alt"></i>
                <span id="lastUpdate">로딩 중...</span>
            </div>
            <a href="/admin/reports" style="color: white; text-decoration: none;">
                <i class="fas fa-flag"></i> 신고 관리
            </a>
            <a href="/admin/users" style="color: white; text-decoration: none;">
                <i class="fas fa-users"></i> 사용자 관리
            </a>
            <a href="/board" style="color: white; text-decoration: none;">
                <i class="fas fa-home"></i> 메인으로
            </a>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Quick Actions -->
        <div class="quick-actions">
            <button class="quick-action-btn" onclick="location.href='/admin/reports'">
                <i class="fas fa-gavel"></i> 신고 처리
            </button>
            <button class="quick-action-btn" onclick="refreshDashboard()">
                <i class="fas fa-sync-alt"></i> 새로고침
            </button>
            <button class="quick-action-btn" onclick="alert('기능 준비중입니다')">
                <i class="fas fa-bell"></i> 공지 작성
            </button>
        </div>

        <!-- Metrics Grid -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">현재 접속자 (30분)</span>
                    <div class="metric-icon blue">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
                <div class="metric-value" id="activeUsers">-</div>
                <div class="metric-change neutral" id="activeUsersChange">
                    <i class="fas fa-info-circle"></i> 최근 활동 기준
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">오늘 신규 가입자</span>
                    <div class="metric-icon green">
                        <i class="fas fa-user-plus"></i>
                    </div>
                </div>
                <div class="metric-value" id="todayNewUsers">-</div>
                <div class="metric-change" id="userGrowth">
                    <i class="fas fa-arrow-up"></i> <span>-</span>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">오늘 작성 게시글</span>
                    <div class="metric-icon purple">
                        <i class="fas fa-file-alt"></i>
                    </div>
                </div>
                <div class="metric-value" id="todayNewBoards">-</div>
                <div class="metric-change" id="boardGrowth">
                    <i class="fas fa-arrow-up"></i> <span>-</span>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">오늘 작성 댓글</span>
                    <div class="metric-icon orange">
                        <i class="fas fa-comments"></i>
                    </div>
                </div>
                <div class="metric-value" id="todayNewComments">-</div>
                <div class="metric-change" id="commentGrowth">
                    <i class="fas fa-arrow-up"></i> <span>-</span>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">미처리 신고</span>
                    <div class="metric-icon red">
                        <i class="fas fa-flag"></i>
                    </div>
                </div>
                <div class="metric-value" id="pendingReports">-</div>
                <div class="metric-change neutral" id="urgentReports">
                    <i class="fas fa-exclamation-triangle"></i> 긴급: <span>-</span>건
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">서버 상태</span>
                    <div class="metric-icon" id="serverStatusIcon">
                        <i class="fas fa-server"></i>
                    </div>
                </div>
                <div class="metric-value" style="font-size: 24px;" id="serverStatus">-</div>
                <div class="metric-change neutral" id="memoryUsage">
                    <i class="fas fa-memory"></i> 메모리: <span>-</span>%
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <div class="chart-card">
                <h3><i class="fas fa-chart-area"></i> 활동 추이</h3>
                <div class="chart-tabs">
                    <button class="chart-tab active" onclick="switchTrendPeriod('7days')">7일</button>
                    <button class="chart-tab" onclick="switchTrendPeriod('30days')">30일</button>
                </div>
                <canvas id="trendChart" style="max-height: 300px;"></canvas>
            </div>

            <div class="chart-card">
                <h3><i class="fas fa-fire"></i> 시간대별 활동 히트맵</h3>
                <canvas id="heatmapChart" style="max-height: 300px;"></canvas>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="activity-section">
            <div class="activity-card">
                <h3><i class="fas fa-newspaper"></i> 최근 게시글</h3>
                <div id="recentBoards">
                    <p style="color: #999; text-align: center; padding: 20px;">로딩 중...</p>
                </div>
            </div>

            <div class="activity-card">
                <h3><i class="fas fa-comment-dots"></i> 최근 댓글</h3>
                <div id="recentComments">
                    <p style="color: #999; text-align: center; padding: 20px;">로딩 중...</p>
                </div>
            </div>

            <div class="activity-card">
                <h3><i class="fas fa-exclamation-circle"></i> 최근 신고 (미처리)</h3>
                <div id="recentReports">
                    <p style="color: #999; text-align: center; padding: 20px;">로딩 중...</p>
                </div>
            </div>

            <div class="activity-card">
                <h3><i class="fas fa-user-check"></i> 최근 가입자</h3>
                <div id="recentUsers">
                    <p style="color: #999; text-align: center; padding: 20px;">로딩 중...</p>
                </div>
            </div>
        </div>

        <!-- Popular Boards -->
        <div class="popular-section">
            <h3><i class="fas fa-trophy"></i> 인기 게시글 TOP 10 (최근 30일)</h3>
            <table class="popular-table">
                <thead>
                    <tr>
                        <th>순위</th>
                        <th>제목</th>
                        <th>작성자</th>
                        <th>조회수</th>
                        <th>좋아요</th>
                        <th>댓글</th>
                        <th>인기도 점수</th>
                    </tr>
                </thead>
                <tbody id="popularBoardsTable">
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px; color: #999;">로딩 중...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let trendChart;
        let heatmapChart;
        let currentTrendPeriod = '7days';
        let autoRefreshInterval;

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            loadDashboardData();
            startAutoRefresh();
        });

        // 자동 새로고침 시작 (30초)
        function startAutoRefresh() {
            autoRefreshInterval = setInterval(() => {
                loadDashboardData();
            }, 30000); // 30초
        }

        // 대시보드 데이터 로드
        async function loadDashboardData() {
            const indicator = document.getElementById('refreshIndicator');
            indicator.classList.add('loading');

            try {
                const response = await fetch('/admin/dashboard/api/stats');
                const result = await response.json();

                if (result.success) {
                    updateDashboard(result.data);
                    updateLastUpdate();
                } else {
                    console.error('Failed to load dashboard:', result.message);
                }
            } catch (error) {
                console.error('Error loading dashboard:', error);
            } finally {
                indicator.classList.remove('loading');
            }
        }

        // 대시보드 업데이트
        function updateDashboard(data) {
            updateMetrics(data.realTimeMetrics);
            updateTrendChart(data.trendData);
            updateRecentActivity(data.recentActivity);
            updatePopularBoards(data.popularBoards);
        }

        // 실시간 지표 업데이트
        function updateMetrics(metrics) {
            document.getElementById('activeUsers').textContent = metrics.activeUsers30min.toLocaleString();
            document.getElementById('todayNewUsers').textContent = metrics.todayNewUsers.toLocaleString();
            document.getElementById('todayNewBoards').textContent = metrics.todayNewBoards.toLocaleString();
            document.getElementById('todayNewComments').textContent = metrics.todayNewComments.toLocaleString();
            document.getElementById('pendingReports').textContent = metrics.pendingReports.toLocaleString();

            // 증감율 표시
            updateGrowthRate('userGrowth', metrics.userGrowthRate);
            updateGrowthRate('boardGrowth', metrics.boardGrowthRate);
            updateGrowthRate('commentGrowth', metrics.commentGrowthRate);

            // 긴급 신고
            document.querySelector('#urgentReports span').textContent = metrics.urgentReports;

            // 서버 상태
            const serverStatus = document.getElementById('serverStatus');
            const serverStatusIcon = document.getElementById('serverStatusIcon');
            const memorySpan = document.querySelector('#memoryUsage span');

            if (metrics.serverStatus) {
                serverStatus.textContent = metrics.serverStatus.status;
                memorySpan.textContent = metrics.serverStatus.memoryUsage.toFixed(1);

                if (metrics.serverStatus.status === 'NORMAL') {
                    serverStatusIcon.className = 'metric-icon green';
                    serverStatus.style.color = '#4caf50';
                } else if (metrics.serverStatus.status === 'WARNING') {
                    serverStatusIcon.className = 'metric-icon orange';
                    serverStatus.style.color = '#ff9800';
                } else {
                    serverStatusIcon.className = 'metric-icon red';
                    serverStatus.style.color = '#f44336';
                }
            }
        }

        // 증감율 업데이트
        function updateGrowthRate(elementId, rate) {
            const element = document.getElementById(elementId);
            const span = element.querySelector('span');
            const icon = element.querySelector('i');

            span.textContent = Math.abs(rate).toFixed(1) + '%';

            if (rate > 0) {
                element.className = 'metric-change positive';
                icon.className = 'fas fa-arrow-up';
            } else if (rate < 0) {
                element.className = 'metric-change negative';
                icon.className = 'fas fa-arrow-down';
            } else {
                element.className = 'metric-change neutral';
                icon.className = 'fas fa-minus';
            }
        }

        // 차트 초기화
        function initCharts() {
            const trendCtx = document.getElementById('trendChart').getContext('2d');
            trendChart = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            const heatmapCtx = document.getElementById('heatmapChart').getContext('2d');
            heatmapChart = new Chart(heatmapCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // 트렌드 차트 업데이트
        function updateTrendChart(trendData) {
            if (!trendData) return;

            const labels = currentTrendPeriod === '7days' ? trendData.last7Days : trendData.last30Days;
            const userTrend = currentTrendPeriod === '7days' ? trendData.userTrend7Days : trendData.userTrend30Days;
            const boardTrend = currentTrendPeriod === '7days' ? trendData.boardTrend7Days : trendData.boardTrend30Days;
            const commentTrend = currentTrendPeriod === '7days' ? trendData.commentTrend7Days : trendData.commentTrend30Days;
            const reportTrend = currentTrendPeriod === '7days' ? trendData.reportTrend7Days : trendData.reportTrend30Days;

            trendChart.data.labels = labels;
            trendChart.data.datasets = [
                {
                    label: '신규 가입자',
                    data: userTrend,
                    borderColor: '#4caf50',
                    backgroundColor: 'rgba(76, 175, 80, 0.1)',
                    tension: 0.4
                },
                {
                    label: '게시글',
                    data: boardTrend,
                    borderColor: '#9c27b0',
                    backgroundColor: 'rgba(156, 39, 176, 0.1)',
                    tension: 0.4
                },
                {
                    label: '댓글',
                    data: commentTrend,
                    borderColor: '#ff9800',
                    backgroundColor: 'rgba(255, 152, 0, 0.1)',
                    tension: 0.4
                },
                {
                    label: '신고',
                    data: reportTrend,
                    borderColor: '#f44336',
                    backgroundColor: 'rgba(244, 67, 54, 0.1)',
                    tension: 0.4
                }
            ];
            trendChart.update();
        }

        // 트렌드 기간 전환
        function switchTrendPeriod(period) {
            currentTrendPeriod = period;
            document.querySelectorAll('.chart-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            loadDashboardData();
        }

        // 최근 활동 업데이트
        function updateRecentActivity(activity) {
            if (!activity) return;

            // 최근 게시글
            const boardsHtml = activity.recentBoards.map(board => `
                <div class="activity-item">
                    <div class="activity-item-header">
                        <span class="activity-item-title" onclick="location.href='/board/${board.id}'">${board.title}</span>
                        <span class="activity-item-time">${board.createdAt}</span>
                    </div>
                    <div class="activity-item-author">${board.author} · 조회 ${board.viewCount} · 좋아요 ${board.likeCount}</div>
                </div>
            `).join('');
            document.getElementById('recentBoards').innerHTML = boardsHtml || '<p style="color: #999; text-align: center; padding: 20px;">데이터 없음</p>';

            // 최근 댓글
            const commentsHtml = activity.recentComments.map(comment => `
                <div class="activity-item">
                    <div class="activity-item-header">
                        <span class="activity-item-title" onclick="location.href='/board/${comment.boardId}'">${comment.content}</span>
                        <span class="activity-item-time">${comment.createdAt}</span>
                    </div>
                    <div class="activity-item-author">${comment.author} → ${comment.boardTitle}</div>
                </div>
            `).join('');
            document.getElementById('recentComments').innerHTML = commentsHtml || '<p style="color: #999; text-align: center; padding: 20px;">데이터 없음</p>';

            // 최근 신고
            const reportsHtml = activity.recentReports.map(report => `
                <div class="activity-item">
                    <div class="activity-item-header">
                        <span class="activity-item-title">${report.targetType} · ${report.reportType}</span>
                        <span class="priority-badge ${report.priority.toLowerCase()}">${report.priority}</span>
                    </div>
                    <div class="activity-item-author">${report.reporter} · ${report.reason}</div>
                </div>
            `).join('');
            document.getElementById('recentReports').innerHTML = reportsHtml || '<p style="color: #999; text-align: center; padding: 20px;">데이터 없음</p>';

            // 최근 가입자
            const usersHtml = activity.recentUsers.map(user => `
                <div class="activity-item">
                    <div class="activity-item-header">
                        <span class="activity-item-title">${user.nickname} (@${user.username})</span>
                        <span class="activity-item-time">${user.createdAt}</span>
                    </div>
                    <div class="activity-item-author">${user.email}</div>
                </div>
            `).join('');
            document.getElementById('recentUsers').innerHTML = usersHtml || '<p style="color: #999; text-align: center; padding: 20px;">데이터 없음</p>';
        }

        // 인기 게시글 업데이트
        function updatePopularBoards(boards) {
            if (!boards || boards.length === 0) {
                document.getElementById('popularBoardsTable').innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: #999;">데이터 없음</td></tr>';
                return;
            }

            const html = boards.map((board, index) => `
                <tr>
                    <td><strong>${index + 1}</strong></td>
                    <td class="title-cell" onclick="location.href='/board/${board.id}'">${board.title}</td>
                    <td>${board.author}</td>
                    <td>${board.viewCount.toLocaleString()}</td>
                    <td>${board.likeCount.toLocaleString()}</td>
                    <td>${board.commentCount.toLocaleString()}</td>
                    <td class="score-cell">${board.popularityScore.toLocaleString()}</td>
                </tr>
            `).join('');

            document.getElementById('popularBoardsTable').innerHTML = html;
        }

        // 마지막 업데이트 시간 표시
        function updateLastUpdate() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            document.getElementById('lastUpdate').textContent = `마지막 업데이트: ${timeStr}`;
        }

        // 수동 새로고침
        function refreshDashboard() {
            document.getElementById('loadingOverlay').classList.add('active');
            loadDashboardData();
            setTimeout(() => {
                document.getElementById('loadingOverlay').classList.remove('active');
            }, 500);
        }

        // 페이지 언로드 시 자동 새로고침 중지
        window.addEventListener('beforeunload', function() {
            clearInterval(autoRefreshInterval);
        });
    </script>
</body>
</html>
