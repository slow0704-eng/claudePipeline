# 목 데이터 삽입 오류 해결 방법

## 🚨 오류 발생 시 해결 순서

### ⭐ 방법 1: 자동 완전 초기화 (가장 확실함, 권장)

이 방법이 **가장 확실**합니다:

```batch
reset_db_and_insert.bat
```

이 스크립트는 자동으로:
1. ✅ DB 테이블 완전 삭제 및 재생성
2. ✅ 목 데이터 삽입
3. ✅ 설정 자동 복원

**장점**: 한 번에 모든 문제 해결
**단점**: 애플리케이션을 잠시 시작했다가 종료함 (자동)

---

### 방법 2: 수동 단계별 초기화

더 안전하게 단계별로 진행하고 싶다면:

#### 1단계: 애플리케이션 종료
실행 중인 Spring Boot 애플리케이션이 있다면 종료

#### 2단계: application.properties 수정
파일 위치: `src\main\resources\application.properties`

다음 줄을 찾아서:
```properties
spring.jpa.hibernate.ddl-auto=update
```

이렇게 변경:
```properties
spring.jpa.hibernate.ddl-auto=create
```

#### 3단계: 애플리케이션 시작 및 종료
```batch
mvnw.cmd spring-boot:run
```

브라우저에서 http://localhost:8080 접속이 되면:
- Ctrl+C 눌러서 종료

이 과정에서 **모든 테이블이 삭제되고 재생성**됩니다.

#### 4단계: application.properties 복원
```properties
spring.jpa.hibernate.ddl-auto=update
```
다시 `update`로 변경

#### 5단계: 목 데이터 삽입
```batch
insert_mock_data.bat
```
옵션 2 선택 (기존 데이터 유지)

---

### 방법 3: 기존 데이터만 삭제 후 재시도

기존 데이터 충돌이 원인이라면:

```batch
clear_mock_data.bat
```

실행 후:

```batch
insert_mock_data.bat
```

---

## 🔍 오류 원인 확인

어떤 원인인지 확인하려면:

```batch
check_db.bat
```

이 스크립트는:
- PostgreSQL 서비스 상태 확인
- 데이터베이스 연결 테스트
- 현재 데이터 개수 확인

---

## 💡 각 방법 비교

| 방법 | 소요 시간 | 확실성 | 난이도 |
|------|----------|--------|--------|
| 방법 1 (reset_db_and_insert.bat) | 약 30초 | ★★★★★ | ★☆☆☆☆ (가장 쉬움) |
| 방법 2 (수동 단계별) | 약 2분 | ★★★★★ | ★★★☆☆ |
| 방법 3 (clear_mock_data.bat) | 약 10초 | ★★★☆☆ | ★☆☆☆☆ |

---

## 🎯 권장 순서

1. **먼저 시도**: `reset_db_and_insert.bat` (가장 확실)
2. **그래도 안 되면**: `check_db.bat`로 원인 확인
3. **수동 확인**: PostgreSQL이 실행 중인지 확인
   ```batch
   sc query postgresql-x64-16
   ```

---

## 📝 주의사항

### ⚠️ admin 계정 관련

현재 목 데이터에는 **admin 계정이 포함되어 있지 않습니다**.

목 데이터 삽입 후:
- ✅ user001 ~ user050 (일반 사용자)
- ❌ admin (없음)

**admin 계정이 필요하다면**:

방법 A: 애플리케이션에서 회원가입
- http://localhost:8080/auth/register
- 첫 번째 가입자가 자동으로 ADMIN 역할 부여될 수 있음 (설정에 따라)

방법 B: SQL로 직접 추가
```sql
INSERT INTO users (username, password, nickname, email, name, role, enabled, created_at)
VALUES ('admin', '$2a$10$N.zmdr9k7uOEXYqUc6JN4.Zq5lP8P5P5P5P5P5P5P5P5P5P5P5P5Pu', '관리자', 'admin@board.com', '시스템관리자', 'ROLE_ADMIN', true, NOW());
```
(비밀번호: 1234)

---

## ✅ 성공 확인

목 데이터가 정상적으로 삽입되었는지 확인:

```batch
mvnw.cmd spring-boot:run
```

브라우저에서:
1. http://localhost:8080 접속
2. 로그인: `user001` / `1234`
3. 게시글 목록이 300+개 보이는지 확인
4. 좋아요, 북마크, 댓글 기능 테스트

---

## 🆘 그래도 안 될 때

1. PostgreSQL 재시작
   ```batch
   net stop postgresql-x64-16
   net start postgresql-x64-16
   ```

2. 비밀번호 확인
   - `application.properties`의 비밀번호
   - `insert_mock_data.bat`의 LOCAL_PASSWORD
   - 둘이 같은지 확인

3. 포트 확인
   - PostgreSQL: 5432 포트
   - 다른 프로그램이 사용 중인지 확인

4. 로그 확인
   - Spring Boot 콘솔 출력
   - PostgreSQL 로그
